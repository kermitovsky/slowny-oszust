<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>S≈Çowny Impostor</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

  <div id="votingOverlay" class="cinematic-overlay voting-style">
    <h1 class="cinematic-title">G≈ÅOSOWANIE!</h1>
    <div class="cinematic-subtitle">Kto jest oszustem?</div>
  </div>
  <div id="starterOverlay" class="cinematic-overlay starter-style">
    <h1 class="cinematic-title">ZACZYNA</h1>
    <div class="cinematic-subtitle" id="starterOverlayName">...</div>
  </div>
  <div id="summaryOverlay" class="cinematic-overlay summary-style">
    <h1 class="cinematic-title" id="summaryOverlayTitle">KONIEC RUNDY</h1>
    <div class="cinematic-subtitle" id="summaryOverlaySubtitle">...</div>
  </div>

  <div id="modalBackdrop"></div>
  <div id="countdownDisplay"></div>

  <button id="themeToggle" class="hidden">üåô</button>
  <button id="rulesBtn" class="hidden">?</button>

  <div id="loginScreen" class="container" data-screen>
    <h1>S≈Çowny Impostor</h1>
    <input type="text" id="playerName" placeholder="Tw√≥j Nick" maxlength="15">
    <div id="emojiSelection"></div>
    <button id="createRoom">Stw√≥rz Pok√≥j</button>
    <input type="text" id="roomCodeInput" placeholder="Kod pokoju (np. ABCD)" maxlength="4" style="text-transform: uppercase;">
    <button id="joinRoom">Do≈ÇƒÖcz do Pokoju</button>
  </div>

  <div id="gameScreen" class="container" data-screen>
    <h1>S≈Çowny Impostor</h1>
    
    <div id="roomCodeContainer">
      <span style="font-size: 1.8rem; margin-right: 1rem;">Kod:</span>
      <span id="roomCodeDisplay"></span>
      <button id="copyRoomCode" title="Skopiuj kod">üìã</button>
      <button id="roomSettingsBtn" title="Ustawienia Pokoju" style="display: none;">‚öôÔ∏è</button>
    </div>

    <div id="countsContainer">
      <p id="playerCountDisplay"></p>
      <p id="impostorCountDisplay"></p>
      <p id="hintChanceInfoDisplay"></p>
    </div>

    <div id="lobbyCategories"></div>
    
    <div id="lastRoundSummaryTitle">Wynik ostatniej rundy:</div>
    <div id="lastRoundSummary"></div>
    
    <div id="roundCounter"></div>
    <div id="wordDisplay"></div>
    <div id="voteResultDisplay"></div>

    <ul id="playersList"></ul>

    <button id="startGame" style="display: none;">Rozpocznij Grƒô</button>
    <button id="startVoteBtn" style="display: none;">Rozpocznij G≈Çosowanie</button>
    <button id="confirmVoteBtn" style="display: none;">Zatwierd≈∫ G≈Ços</button>
    <button id="endRound" style="display: none;">Zako≈Ñcz Rundy Wcze≈õnie</button>
    <button id="leaveRoom">Opu≈õƒá Pok√≥j</button>
  </div>

  <div id="roleMessageBox" class="modal-box role-card-modal">
    <div class="role-card-scene">
      <div class="role-card" id="roleCardInner">
        <div class="role-card-face role-card-back">
          <div class="card-question-mark">?</div>
          <div class="card-cycle-icon">üîÑ</div>
        </div>
        <div class="role-card-face role-card-front">
          <div id="roleContent"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="messageBox" class="modal-box"></div>

  <div id="categorySelectionBox" class="modal-box">
    <button class="close-btn" id="closeCategories">√ó</button>
    <p>Wybierz kategorie s≈Ç√≥w</p>
    <div class="category-grid custom-scrollbar">
      <button class="category-btn custom-new-btn" id="createCustomCategoryBtn">+ Stw√≥rz w≈ÇasnƒÖ</button>
    </div>
    <div class="checkbox-container" id="allCategoriesBtn">
      <input type="checkbox" id="allCategoriesCheckbox">
      <label for="allCategoriesCheckbox"><div class="checkbox"></div>Zaznacz wszystkie standardowe</label>
    </div>
    <button id="confirmCategories">Dalej ‚ûî</button>
  </div>

  <div id="customCategoryBox" class="modal-box">
    <button class="close-btn" id="closeCustomCategoryBtn">√ó</button>
    <h2>W≈Çasna Kategoria</h2>
    <input type="text" id="customCategoryNameInput" placeholder="Nazwa (np. Has≈Ça z naszej pracy)" maxlength="20">
    <div class="custom-word-adder">
      <input type="text" id="customWordInput" placeholder="Dodaj s≈Çowo..." maxlength="30">
      <button id="addCustomWordBtn">+</button>
    </div>
    <ul id="customWordsList" class="custom-scrollbar"></ul>
    <button id="saveCustomCategoryBtn" disabled>Zapisz i u≈ºyj</button>
  </div>

  <div id="impostorSelectionBox" class="modal-box">
    <p>Ilu oszust√≥w?</p>
    <div class="impostor-selector">
      <button id="minusImpostor" disabled>-</button>
      <span id="impostorCount" style="font-size: 3.5rem; font-weight: bold; margin: 0 1.5rem;">1</span>
      <button id="plusImpostor">+</button>
    </div>
    <div id="loadingMessage" style="display:none; color: var(--c-accent);">≈Åadowanie s≈Ç√≥w...</div>
    <div id="recommendedPlayers">Zalecana liczba graczy: 3-5</div>
    <button id="confirmImpostors">Dalej ‚ûî</button>
  </div>

  <div id="impostorHintBox" class="modal-box">
    <p>Podpowied≈∫ dla oszusta</p>
    
    <div class="checkbox-container" id="customHintToggleContainer" style="margin-bottom: 2rem; border: 2px solid var(--c-primary); padding: 1rem; border-radius: 1rem; background: rgba(142,68,173,0.1);">
      <input type="checkbox" id="customHintCheckbox">
      <label for="customHintCheckbox">
        <div class="checkbox"></div>
        <div style="text-align: left; line-height: 1.2;">
          <span style="font-weight: bold; color: var(--c-primary-light);">W≈Çasne podpowiedzi graczy</span><br>
          <span style="font-size: 1.2rem; opacity: 0.8;">Oszust dostanie jedno s≈Çowo od niewinnego</span>
        </div>
      </label>
    </div>

    <div id="autoHintSettingsWrapper">
      <div class="slider-container">
        <input type="range" id="hintChanceSlider" min="0" max="4" value="0">
        <div class="slider-labels">
          <span class="slider-label label-active">0%</span>
          <span class="slider-label">25%</span>
          <span class="slider-label">50%</span>
          <span class="slider-label">75%</span>
          <span class="slider-label">100%</span>
        </div>
      </div>
      <div class="checkbox-container">
        <input type="checkbox" id="hintOnStartCheckbox">
        <label for="hintOnStartCheckbox"><div class="checkbox"></div>Zawsze, gdy oszust zaczyna</label>
      </div>
    </div>
    
    <button id="confirmHintSettingsBtn">Dalej ‚ûî</button>
  </div>

  <div id="impostorTeamBox" class="modal-box">
    <p>Czy oszu≈õci siƒô znajƒÖ?</p>
    <div class="team-selector">
      <button id="teamKnowsBtn">Tak</button>
      <button id="teamNotKnowsBtn" class="selected">Nie</button>
    </div>
    <button id="confirmTeamSettingsBtn">Stw√≥rz Pok√≥j ‚úî</button>
  </div>

  <div id="roomSettingsBox" class="modal-box">
    <button class="close-btn" id="closeRoomSettingsBtn">√ó</button>
    <h2 style="font-size: 2.5rem; margin-bottom: 2rem;">Ustawienia Pokoju</h2>
    <div class="custom-scrollbar" style="max-height: 50vh; overflow-y: auto; padding-right: 1rem;">
      
      <div class="settings-group">
        <p>Ilu oszust√≥w?</p>
        <div class="impostor-selector">
          <button id="setMinusImpostor">-</button>
          <span id="setImpostorCount" style="font-size: 2.5rem; font-weight: bold; margin: 0 1.5rem;">1</span>
          <button id="setPlusImpostor">+</button>
        </div>
      </div>

      <div class="settings-group">
        <p>System Podpowiedzi</p>
        <div class="checkbox-container" id="setCustomHintToggleContainer" style="margin: 1rem auto; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.2);">
          <input type="checkbox" id="setCustomHintCheckbox">
          <label for="setCustomHintCheckbox">
            <div class="checkbox"></div>
            <div style="text-align: left; line-height: 1.2;">
              <span style="font-weight: bold; color: var(--c-primary-light);">W≈Çasne podpowiedzi graczy</span><br>
              <span style="font-size: 1.1rem; opacity: 0.8;">Wszyscy piszƒÖ s≈Çowo przed rundƒÖ</span>
            </div>
          </label>
        </div>

        <div id="setAutoHintSettingsWrapper">
          <div class="slider-container" style="margin: 2rem auto 3rem auto;">
            <input type="range" id="setHintChanceSlider" min="0" max="4" value="0">
            <div class="slider-labels" id="setSliderLabels">
              <span class="slider-label label-active">0%</span>
              <span class="slider-label">25%</span>
              <span class="slider-label">50%</span>
              <span class="slider-label">75%</span>
              <span class="slider-label">100%</span>
            </div>
          </div>
          <div class="checkbox-container" id="setHintCheckboxContainer" style="margin: 0 auto;">
            <input type="checkbox" id="setHintOnStartCheckbox">
            <label for="setHintOnStartCheckbox"><div class="checkbox"></div>Gdy oszust zaczyna</label>
          </div>
        </div>
      </div>

      <div class="settings-group" id="setTeamGroup">
        <p>Czy oszu≈õci siƒô znajƒÖ?</p>
        <div class="team-selector">
          <button id="setTeamKnowsBtn">Tak</button>
          <button id="setTeamNotKnowsBtn" class="selected">Nie</button>
        </div>
      </div>
    </div>
    <button id="saveRoomSettingsBtn">Zapisz Zmiany</button>
  </div>

  <div id="hintInputBox" class="modal-box">
    <h2 id="hintInputTitle" style="font-size: 3rem; margin-bottom: 1rem;">Czas na podpowied≈∫!</h2>
    <p id="hintInputDesc" style="font-size: 1.6rem; margin-bottom: 2rem; line-height: 1.4;"></p>
    <input type="text" id="customHintInput" placeholder="Wpisz jedno s≈Çowo..." maxlength="20" autocomplete="off">
    <button id="submitCustomHintBtn" style="background: var(--c-success);">Gotowe</button>
    <div id="hintWaitingMessage" style="display:none; font-size: 1.8rem; margin-top: 1.5rem; color: var(--c-accent); font-weight: bold; animation: pulse 1.5s infinite;">Oczekiwanie na resztƒô graczy...</div>
  </div>

  <div id="rulesBox" class="modal-box">
    <button class="close-btn" id="closeRulesTop">√ó</button>
    <h2>Jak Graƒá?</h2>
    <div class="custom-scrollbar" style="max-height: 60vh; overflow-y: auto; padding-right: 10px;">
      <p>üë• <b>Gracze:</b> Minimum 3 (Zalecane 4+).</p>
      <h3>Zasady:</h3>
      <ul>
        <li>Oszust (Impostor) <b>nie zna has≈Ça</b>. Reszta graczy je zna.</li>
        <li>Gra losuje, kto zaczyna (üé§). ZaczynajƒÖca osoba m√≥wi <b>jedno s≈Çowo</b> kojarzƒÖce siƒô z has≈Çem.</li>
        <li>Kolejni gracze (zgodnie z ruchem wskaz√≥wek zegara) te≈º podajƒÖ po jednym s≈Çowie.</li>
        <li><b>Cel Niewinnych:</b> Udowodniƒá, ≈ºe znajƒÖ has≈Ço, ale podaƒá s≈Çowo na tyle trudne, by oszust siƒô nie domy≈õli≈Ç.</li>
        <li><b>Cel Oszusta:</b> Udawaƒá, ≈ºe wie o co chodzi i nie daƒá siƒô z≈Çapaƒá!</li>
      </ul>
      <h3>G≈Çosowanie:</h3>
      <ul>
        <li>Po ustalonym czasie (lub liczbie okrƒÖ≈ºe≈Ñ) rozpoczyna siƒô g≈Çosowanie.</li>
        <li>Je≈õli wiƒôkszo≈õƒá wska≈ºe oszusta - <b>Niewinni wygrywajƒÖ</b>.</li>
        <li>Je≈õli oszust przetrwa (remis lub wskazano niewinnego) - <b>Oszust wygrywa</b>.</li>
      </ul>
    </div>
    <button class="close-btn-bottom" id="closeRules">Zrozumia≈Çem</button>
  </div>

  <script src="script.js"></script>
</body>
</html>
